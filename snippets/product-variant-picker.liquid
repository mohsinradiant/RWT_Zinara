{% comment %}
  Renders product variant-picker

  Accepts:
  - product: {Object} product object.
  - block: {Object} passing the block information.
  - product_form_id: {String} Id of the product form to which the variant picker is associated.
  Usage:
  {% render 'product-variant-picker', product: product, block: block, product_form_id: product_form_id %}
{% endcomment %}
{%- unless product.has_only_default_variant -%}
  <variant-selects
    id="variant-selects-{{ section.id }}"
    data-section="{{ section.id }}"
    {{ block.shopify_attributes }}
  >
    {%- for option in product.options_with_values -%}
      {%- liquid
        assign swatch_count = option.values | map: 'swatch' | compact | size
        assign picker_type = block.settings.picker_type

        if swatch_count > 0 and block.settings.swatch_shape != 'none'
          if block.settings.picker_type == 'dropdown'
            assign picker_type = 'swatch_dropdown'
          else
            assign picker_type = 'swatch'
          endif
        endif
      -%}
      {%- if picker_type == 'swatch' -%}
        <fieldset class="js product-form__input product-form__input--swatch">
          <legend class="form__label">
            {{ option.name }}:
            <span data-selected-value>
              {{- option.selected_value -}}
            </span>
          </legend>
          {% render 'product-variant-options',
            product: product,
            option: option,
            block: block,
            picker_type: picker_type
          %}
        </fieldset>
      {%- elsif picker_type == 'button' -%}
        <fieldset class="js product-form__input product-form__input--pill">
          <legend class="form__label">{{ option.name }}</legend>
          {% render 'product-variant-options',
            product: product,
            option: option,
            block: block,
            picker_type: picker_type
          %}
        </fieldset>
      {%- else -%}
        <div class="product-form__input product-form__input--dropdown">
          {% comment %}
            <label class="form__label" for="Option-{{ section.id }}-{{ forloop.index0 }}">
              {{ option.name }}
            </label>
          {% endcomment %}
          <div class="select">
            {% comment %}
              {%- if picker_type == 'swatch_dropdown' -%}
                <span
                  data-selected-value
                  class="dropdown-swatch"
                >
                  {% render 'swatch', swatch: option.selected_value.swatch, shape: block.settings.swatch_shape %}
                </span>
              {%- endif -%}
            {% endcomment %}
            <select
              id="Option-{{ section.id }}-{{ forloop.index0 }}"
              class="select__select"
              name="options[{{ option.name | escape }}]"
              form="{{ product_form_id }}"
            >
              {% render 'product-variant-options',
                product: product,
                option: option,
                block: block,
                picker_type: picker_type
              %}
            </select>
            <span class="svg-wrapper">
              {% comment %} {{- 'icon-caret.svg' | inline_asset_content -}} {% endcomment %}
              <img src="https://cdn.shopify.com/s/files/1/0661/8336/4792/files/Vector_16.png?v=1738755650">
            </span>
            {% if option.name == 'Ring Size' %}
              <ul class="custom-dropdown-options">
                {% for value in option.values %}
                  <li
                    data-value="{{ value | escape }}"
                    class="dropdown-option {% if value.selected %}selected{% endif %}"
                  >
                    {{ value }}
                  </li>
                {% endfor %}
              </ul>
            {% endif %}
          </div>
        </div>
      {%- endif -%}
    {%- endfor -%}
    <style>
      /* Hide the default dropdown arrow */
      .select {
        position: relative;
        width: 100%;
      }

      .custom-select {
        position: relative;
        width: 100%;
        padding: 10px;
        background: white;
        border: 1px solid #ccc;
        cursor: pointer;
        appearance: none;
        pointer-events: none;
      }

      /* Custom dropdown */
      .custom-dropdown-options {
        list-style: none;
        padding: 0;
        margin: 0;
        display: none;
        background: white;
        border: 1px solid #ccc;
        z-index: 10;
        left: 10%;
        right: 0%;
        position: fixed;
      }

      .dropdown-option {
        padding: 10px;
        cursor: pointer;
      }

      .dropdown-option:hover {
        background: #f0f0f0;
      }

      .custom-dropdown-options.active {
        display: block;
      }

      .selected {
        font-weight: bold;
        color: #be1e28; /* Your theme's accent color */
      }
    </style>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.select').forEach(function (selectWrapper) {
          const select = selectWrapper.querySelector('.select__select');
          const dropdown = selectWrapper.querySelector('.custom-dropdown-options');
          const options = dropdown.querySelectorAll('.dropdown-option');

          // Prevent native dropdown
          select.addEventListener('mousedown', function (e) {
            e.preventDefault(); // Prevents default dropdown
            dropdown.classList.toggle('active');
          });

          // Select an option
          options.forEach(function (option) {
            option.addEventListener('click', function () {
              const selectedValue = option.getAttribute('data-value');
              select.value = selectedValue; // Update select value
              dropdown.classList.remove('active');

              // Update selected state
              options.forEach((opt) => opt.classList.remove('selected'));
              option.classList.add('selected');

              // Dispatch a change event for Shopify
              select.dispatchEvent(new Event('change', { bubbles: true }));
            });
          });

          // Close dropdown when clicking outside
          document.addEventListener('click', function (e) {
            if (!selectWrapper.contains(e.target)) {
              dropdown.classList.remove('active');
            }
          });
        });
      });
    </script>

    <script type="application/json" data-selected-variant>
      {{ product.selected_or_first_available_variant | json }}
    </script>
  </variant-selects>
  <div class="sizing-guide">
    <button id="openPopup">Sizing Guide</button>
  </div>

  <div class="popup" id="popup">
    <button class="close-btn" id="closePopup">&times;</button>
    <img
      src="https://cdn.shopify.com/s/files/1/0661/8336/4792/files/Zinara_Ring_Size_Guide_removed_page-0001.jpg?v=1738784512"
      alt="Sizing Guide Image"
    >
  </div>
  <script>
    const openPopup = document.getElementById('openPopup');
    const closePopup = document.getElementById('closePopup');
    const popup = document.getElementById('popup');

    openPopup.addEventListener('click', () => {
      popup.style.display = 'flex';
      // document.body.classList.add('no-scroll');
    });

    closePopup.addEventListener('click', () => {
      popup.style.display = 'none';
      // document.body.classList.remove('no-scroll');
    });

    popup.addEventListener('click', (e) => {
      if (e.target === popup) {
        popup.style.display = 'none';
        // document.body.classList.remove('no-scroll');
      }
    });
  </script>
{%- endunless -%}
