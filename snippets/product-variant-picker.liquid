{% comment %}
  Renders product variant-picker

  Accepts:
  - product: {Object} product object.
  - block: {Object} passing the block information.
  - product_form_id: {String} Id of the product form to which the variant picker is associated.
  Usage:
  {% render 'product-variant-picker', product: product, block: block, product_form_id: product_form_id %}
{% endcomment %}
{%- unless product.has_only_default_variant -%}
  <variant-selects
    id="variant-selects-{{ section.id }}"
    data-section="{{ section.id }}"
    {{ block.shopify_attributes }}
  >
    {%- for option in product.options_with_values -%}
      {%- liquid
        assign swatch_count = option.values | map: 'swatch' | compact | size
        assign picker_type = block.settings.picker_type

        if swatch_count > 0 and block.settings.swatch_shape != 'none'
          if block.settings.picker_type == 'dropdown'
            assign picker_type = 'swatch_dropdown'
          else
            assign picker_type = 'swatch'
          endif
        endif
      -%}
      {%- if picker_type == 'swatch' -%}
        <fieldset class="js product-form__input product-form__input--swatch">
          <legend class="form__label">
            {{ option.name }}:
            <span data-selected-value>
              {{- option.selected_value -}}
            </span>
          </legend>
          {% render 'product-variant-options',
            product: product,
            option: option,
            block: block,
            picker_type: picker_type
          %}
        </fieldset>
      {%- elsif picker_type == 'button' -%}
        <fieldset class="js product-form__input product-form__input--pill">
          <legend class="form__label">{{ option.name }}</legend>
          {% render 'product-variant-options',
            product: product,
            option: option,
            block: block,
            picker_type: picker_type
          %}
        </fieldset>
      {%- else -%}
        <div class="product-form__input product-form__input--dropdown">
          <select
            id="Option-{{ section.id }}-{{ forloop.index0 }}"
            class="select__select"
            name="options[{{ option.name | escape }}]"
            form="{{ product_form_id }}"
          >
            {% for value in option.values %}
              {% assign variant = product.variants | where: 'option' | includes: value | first %}

              {% if variant %}
                {% if variant.inventory_management and variant.inventory_quantity > 0 %}
                  <option value="{{ value | escape }}">
                    {{ value }} - {{ variant.inventory_quantity }} left in stock
                  </option>
                {% else %}
                  <option value="{{ value | escape }}">{{ value }} - Made to Order</option>
                {% endif %}
              {% else %}
                <option value="{{ value | escape }}" disabled>{{ value }} - Out of Stock</option>
              {% endif %}
            {% endfor %}
          </select>
        </div>
        <script>
          document.addEventListener('DOMContentLoaded', function () {
            const variantSelects = document.querySelectorAll('.select__select');

            variantSelects.forEach((select) => {
              select.addEventListener('change', function () {
                const form = this.closest('form');
                if (form) {
                  form.dispatchEvent(new Event('submit', { bubbles: true }));
                }
              });
            });
          });
        </script>
      {%- endif -%}
    {%- endfor -%}
    <script type="application/json" data-selected-variant>
      {{ product.selected_or_first_available_variant | json }}
    </script>
  </variant-selects>
  <div class="sizing-guide">
    <button id="openPopup">Sizing Guide</button>
  </div>
  <div class="popup" id="popup">
    <button class="close-btn" id="closePopup">&times;</button>
    <img
      src="https://cdn.shopify.com/s/files/1/0661/8336/4792/files/Zinara_Ring_Size_Guide_removed_page-0001.jpg?v=1738784512"
      alt="Sizing Guide Image"
    >
  </div>
  <script>
    const openPopup = document.getElementById('openPopup');
    const closePopup = document.getElementById('closePopup');
    const popup = document.getElementById('popup');

    openPopup.addEventListener('click', () => {
      popup.style.display = 'flex';
      // document.body.classList.add('no-scroll');
    });

    closePopup.addEventListener('click', () => {
      popup.style.display = 'none';
      // document.body.classList.remove('no-scroll');
    });

    popup.addEventListener('click', (e) => {
      if (e.target === popup) {
        popup.style.display = 'none';
        // document.body.classList.remove('no-scroll');
      }
    });
  </script>
{%- endunless -%}
