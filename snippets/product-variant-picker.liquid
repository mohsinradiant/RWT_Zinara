{% comment %}
  Renders product variant-picker

  Accepts:
  - product: {Object} product object.
  - block: {Object} passing the block information.
  - product_form_id: {String} Id of the product form to which the variant picker is associated.
  Usage:
  {% render 'product-variant-picker', product: product, block: block, product_form_id: product_form_id %}
{% endcomment %}
{%- unless product.has_only_default_variant -%}
  <variant-selects
    id="variant-selects-{{ section.id }}"
    data-section="{{ section.id }}"
    {{ block.shopify_attributes }}
  >
    {%- for option in product.options_with_values -%}
      {%- liquid
        assign swatch_count = option.values | map: 'swatch' | compact | size
        assign picker_type = block.settings.picker_type

        if swatch_count > 0 and block.settings.swatch_shape != 'none'
          if block.settings.picker_type == 'dropdown'
            assign picker_type = 'swatch_dropdown'
          else
            assign picker_type = 'swatch'
          endif
        endif
      -%}
      {%- if picker_type == 'swatch' -%}
        <fieldset class="js product-form__input product-form__input--swatch">
          <legend class="form__label">
            {{ option.name }}:
            <span data-selected-value>
              {{- option.selected_value -}}
            </span>
          </legend>
          {% render 'product-variant-options',
            product: product,
            option: option,
            block: block,
            picker_type: picker_type
          %}
        </fieldset>
      {%- elsif picker_type == 'button' -%}
        <fieldset class="js product-form__input product-form__input--pill">
          <legend class="form__label">{{ option.name }}</legend>
          {% render 'product-variant-options',
            product: product,
            option: option,
            block: block,
            picker_type: picker_type
          %}
        </fieldset>
      {%- else -%}
        <div class="product-form__input product-form__input--dropdown">
          <div class="select">
            {% if option.name == 'Ring Size' %}
              <div class="custom-dropdown">
                <button type="button" class="dropdown-toggle">Select Ring Size</button>
                <ul class="dropdown-options">
                  {% for value in option.values %}
                    <li
                      data-value="{{ value | escape }}"
                      class="dropdown-option"
                    >
                      {{ value }}
                    </li>
                  {% endfor %}
                </ul>
                <input
                  type="hidden"
                  name="options[{{ option.name | escape }}]"
                  form="{{ product_form_id }}"
                  class="selected-option"
                >
              </div>
            {% else %}
              <select
                id="Option-{{ section.id }}-{{ forloop.index0 }}"
                class="select__select"
                name="options[{{ option.name | escape }}]"
                form="{{ product_form_id }}"
              >
                {% render 'product-variant-options',
                  product: product,
                  option: option,
                  block: block,
                  picker_type: picker_type
                %}
              </select>
              <span class="svg-wrapper">
                <img src="https://cdn.shopify.com/s/files/1/0661/8336/4792/files/Vector_16.png?v=1738755650">
              </span>
            {% endif %}
          </div>
        </div>

        <style>
          .custom-dropdown {
            position: relative;
            display: inline-block;
            width: 100%;
          }
          .dropdown-toggle {
            width: 100%;
            padding: 10px;
            background: white;
            border: 1px solid #ccc;
            cursor: pointer;
            text-align: left;
          }
          .dropdown-options {
            list-style: none;
            padding: 0;
            margin: 0;
            position: absolute;
            width: 100%;
            display: none;
            background: white;
            border: 1px solid #ccc;
            z-index: 10;
          }
          .dropdown-option {
            padding: 10px;
            cursor: pointer;
          }
          .dropdown-option:hover {
            background: #f0f0f0;
          }
          .custom-dropdown.active .dropdown-options {
            display: block;
          }
        </style>

        <script>
          document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.custom-dropdown').forEach(function (dropdown) {
              const button = dropdown.querySelector('.dropdown-toggle');
              const optionsList = dropdown.querySelector('.dropdown-options');
              const input = dropdown.querySelector('.selected-option');

              button.addEventListener('click', function () {
                dropdown.classList.toggle('active');
              });

              optionsList.querySelectorAll('.dropdown-option').forEach(function (option) {
                option.addEventListener('click', function () {
                  const selectedValue = option.getAttribute('data-value');
                  button.textContent = selectedValue;
                  input.value = selectedValue;
                  dropdown.classList.remove('active');
                });
              });

              document.addEventListener('click', function (event) {
                if (!dropdown.contains(event.target)) {
                  dropdown.classList.remove('active');
                }
              });
            });
          });
        </script>
      {%- endif -%}
    {%- endfor -%}

    <script type="application/json" data-selected-variant>
      {{ product.selected_or_first_available_variant | json }}
    </script>
  </variant-selects>
  <div class="sizing-guide">
    <button id="openPopup">Sizing Guide</button>
  </div>

  <div class="popup" id="popup">
    <button class="close-btn" id="closePopup">&times;</button>
    <img
      src="https://cdn.shopify.com/s/files/1/0661/8336/4792/files/Zinara_Ring_Size_Guide_removed_page-0001.jpg?v=1738784512"
      alt="Sizing Guide Image"
    >
  </div>
  <script>
    const openPopup = document.getElementById('openPopup');
    const closePopup = document.getElementById('closePopup');
    const popup = document.getElementById('popup');

    openPopup.addEventListener('click', () => {
      popup.style.display = 'flex';
      // document.body.classList.add('no-scroll');
    });

    closePopup.addEventListener('click', () => {
      popup.style.display = 'none';
      // document.body.classList.remove('no-scroll');
    });

    popup.addEventListener('click', (e) => {
      if (e.target === popup) {
        popup.style.display = 'none';
        // document.body.classList.remove('no-scroll');
      }
    });
  </script>
{%- endunless -%}
